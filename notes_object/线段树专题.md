# 线段树专题

平衡复杂度

从最简单的区间加，单点求引入。

关于线段树结构的思考：如何将区间分成log个区间，而且单点所属的区间不超过log个

前缀后缀的拆分，log简单。如何将前缀后缀扩展到区间--分治

于是我们就发现了线段树的结构。

区间修改为什么是单log？

到区间被分成两半的地方，然后两边都是log，上面也是log

区间加，区间查。仍然可以O(n)-O(1)的操作，

练习题

我们尝试修改o(n)时做的事情，我们把前缀加加k遍

这时候区间加，查询的东西就不一样了

那如何使用线段树优化呢？



动态开点的理解

线段树合并

树上

线段树分裂

两个序列区间上的交换

可持久化线段树



线段树的基础用法思考

线段树--区间合并

--单点修改

一些特殊的线段树

兔队线段树

前/后缀最值个数或者啥其他信息

https://www.luogu.com.cn/problem/P4198

取minmax的线段树

发现取minmax后一个值的数会出现很多次，于是我们考虑是否可以把一个值的数一起处理，那么这个区间不能出现其他值的数变化。

记录次大，思考值域的合并，每次进入都代表有两个不同值的数变成一个值，势能分析大概感觉一下最多log^2

KTT

https://www.luogu.com.cn/problem/P5693

对于区间最大子段和+线段树基本操作（需要是使得最大子段和向上的，比如+，取max……）问题

我们可以考虑给每个线段树节点算出一个阈值表示子树上发生选择改变的最小操作范围，然后递归时判断是否会影响子树即可。这样均摊下来复杂度是$O(nlog^3 n)$但是常数非常的小。

同样，在一些单调的问题上，也可以使用类似的手法用线段树来解决。

对线段树上重复信息的思考：

历史和历史最值之类的

线段树上tag的写法

关键在于修改挂上去和tagpushdown，修改挂上去肯定比后者简单。

于是我们只需要讨论tag之间的合并。

于是如果遇到这种考tag的题，我们要做的事情就是设计tag，验证是否能合并，不能就加tag

历史和

首先考虑我们要的tag，可以先不考虑复杂的tag合并，而考虑挂上去修改，我们发现我们需要历史和和区间和。

接下来考虑tag合并。我们发现还需要一个tag前缀和类似的东西，然后就可以合并了。

练习：历史最值的标记设计

https://www.luogu.com.cn/problem/P4314

https://www.luogu.com.cn/problem/P8868

对tag的思考：

tag实际上就是一个整体处理的。但是要注意的是，上面的tag对我的影响和我对下面tag的影响，要保证tag之间是能够合并的。同样，不仅tag，保存的信息之间也是要能够合并的。

不要把它想的过于复杂，包括tag的可持久化，只要举不出反例就是对的，不要被传统思维束手束脚。但是同时tag的处理是十分精细的，因此在写代码的时候要十分注意细节。

如果有时间：

矩阵乘法和线段树上tag的关系

能不能再tag上放一个数据结构，这可能是很多人做题时候想干的事情。

挂修改很简单，直接可持久化就好了，但是tag的合并呢，线段树/平衡树的合并时均摊的，要严格的合并log--左偏树，于是只有左偏树能尝试挂再tag上。

https://www.cnblogs.com/alex-wei/p/18356369/SegmentTreePart1



